{"version":3,"file":"Overview-23ab5211.js","sources":["../../../../billing/src/icons/UnPaidBillIcon.vue","../../../../billing/src/components/AddPrepaidCreditsModal.vue","../../../../billing/src/components/CurrentPlan.vue","../../../../billing/src/components/BillingDetailsModal.vue","../../../../billing/src/components/ChangeCardModal.vue","../../../../billing/src/components/PaymentDetails.vue","../../../../billing/src/pages/Overview.vue"],"sourcesContent":["<template>\n\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t<path\n\t\t\tfill-rule=\"evenodd\"\n\t\t\tclip-rule=\"evenodd\"\n\t\t\td=\"M4 1.43311C3.17157 1.43311 2.5 2.10468 2.5 2.93311V13.9522L3.99324 12.7444C4.19295 12.5828 4.48257 12.5989 4.66319 12.7815L6.15385 14.2887L7.6445 12.7815C7.73842 12.6865 7.86643 12.6331 8 12.6331C8.13357 12.6331 8.26158 12.6865 8.3555 12.7815L9.84615 14.2887L11.3368 12.7815C11.5174 12.5989 11.807 12.5828 12.0068 12.7444L13.5 13.9522V2.9331C13.5 2.10468 12.8284 1.43311 12 1.43311H4ZM1.5 2.93311C1.5 1.55239 2.61929 0.433105 4 0.433105H12C13.3807 0.433105 14.5 1.55239 14.5 2.9331V14.9998C14.5 15.1925 14.3893 15.368 14.2154 15.451C14.0415 15.534 13.8354 15.5097 13.6855 15.3885L11.7296 13.8064L10.2017 15.3514C10.1077 15.4463 9.97972 15.4998 9.84615 15.4998C9.71259 15.4998 9.58457 15.4463 9.49065 15.3514L8 13.8442L6.50935 15.3514C6.41543 15.4463 6.28741 15.4998 6.15385 15.4998C6.02028 15.4998 5.89227 15.4463 5.79834 15.3514L4.27036 13.8064L2.31445 15.3885C2.16464 15.5097 1.95852 15.534 1.78462 15.451C1.61073 15.368 1.5 15.1925 1.5 14.9998V2.93311ZM4 5.5C4 5.22386 4.22386 5 4.5 5H11.5C11.7761 5 12 5.22386 12 5.5C12 5.77614 11.7761 6 11.5 6H4.5C4.22386 6 4 5.77614 4 5.5ZM4.5 9C4.22386 9 4 9.22386 4 9.5C4 9.77614 4.22386 10 4.5 10H11.5C11.7761 10 12 9.77614 12 9.5C12 9.22386 11.7761 9 11.5 9H4.5Z\"\n\t\t\tfill=\"currentColor\"\n\t\t/>\n\t</svg>\n</template>\n","<template>\n\t<Dialog v-model=\"show\" :options=\"{ title: 'Add Credit Balance' }\">\n\t\t<template #body-content>\n\t\t\t<div v-if=\"showMessage\" class=\"inline-flex gap-1.5 text-base mb-5 text-gray-700\">\n\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t<span> Add credits to your account before changing the payment mode. </span>\n\t\t\t</div>\n\t\t\t<PrepaidCreditsForm\n\t\t\t\t@success=\"\n\t\t\t\t\t() => {\n\t\t\t\t\t\tshow = false\n\t\t\t\t\t\temit('success')\n\t\t\t\t\t}\n\t\t\t\t\"\n\t\t\t/>\n\t\t</template>\n\t</Dialog>\n</template>\n<script setup>\nimport PrepaidCreditsForm from './PrepaidCreditsForm.vue'\nimport { Dialog, FeatherIcon } from 'frappe-ui'\n\nconst props = defineProps({\n\tshowMessage: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n})\n\nconst emit = defineEmits(['success'])\nconst show = defineModel()\n</script>\n","<template>\n\t<div class=\"flex flex-col gap-4\">\n\t\t<div class=\"text-lg font-semibold text-gray-900\">\n\t\t\t{{ 'Current plan' }}\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"currentPlan?.is_trial_plan\"\n\t\t\tclass=\"flex justify-between shadow rounded-lg py-3 px-4 text-base\"\n\t\t>\n\t\t\t<div class=\"flex gap-3\">\n\t\t\t\t<div class=\"flex flex-col gap-4 flex-1\">\n\t\t\t\t\t<div class=\"flex flex-col gap-1.5\">\n\t\t\t\t\t\t<div class=\"font-semibold text-gray-900 text-lg\">\n\t\t\t\t\t\t\t{{ currentPlan.is_trial_plan ? 'Trial plan' : currentPlan.name }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"currentPlan.is_trial_plan\" class=\"text-gray-700\">\n\t\t\t\t\t\t\t{{ trialDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"currentPlan.is_trial_plan && currentPlan.support_included\"\n\t\t\t\t\t\tclass=\"text-gray-700 inline-flex items-center gap-1.5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t\t\t<span> Support Included </span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else class=\"text-gray-700\">\n\t\t\t\t\t\t<span>{{ currency }}{{ price.value }}</span>\n\t\t\t\t\t\t<span class=\"font-normal\">{{ ' / month · See plan details' }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Button\n\t\t\t\tvariant=\"solid\"\n\t\t\t\t:label=\"currentPlan.is_trial_plan ? 'Upgrade now' : 'Change plan'\"\n\t\t\t\t@click=\"emit('changePlan')\"\n\t\t\t/>\n\t\t</div>\n\t\t<div\n\t\t\tv-else-if=\"currentPlan\"\n\t\t\tclass=\"flex flex-col shadow rounded-lg text-base text-gray-900\"\n\t\t>\n\t\t\t<div class=\"flex flex-col gap-2.5 py-3 px-4\">\n\t\t\t\t<div class=\"flex justify-between items-center\">\n\t\t\t\t\t<div class=\"flex flex-col gap-1.5\">\n\t\t\t\t\t\t<div class=\"font-semibold text-lg\">Recurring Charges</div>\n\t\t\t\t\t\t<div class=\"text-gray-700\">\n\t\t\t\t\t\t\t<span>Next charge date — </span>\n\t\t\t\t\t\t\t<span>{{ currentMonthEnd() }}</span>\n\t\t\t\t\t\t\t<span> · </span>\n\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t<template #body>\n\t\t\t\t\t\t\t\t\t<PlanDetails :plan=\"currentPlan\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"hover:underline cursor-pointer\">\n\t\t\t\t\t\t\t\t\tSee plan details\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"flex flex-col gap-1.5 text-end\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class=\"font-semibold text-xl\"> {{ currency }}{{ price }} </span>\n\t\t\t\t\t\t\t<span>/mo</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"text-gray-600\">\n\t\t\t\t\t\t\t<span>{{ currency }}{{ (price / 30).toFixed(2) }}</span>\n\t\t\t\t\t\t\t<span>/day</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex justify-between items-center\">\n\t\t\t\t\t<div class=\"text-gray-700 flex gap-2\">\n\t\t\t\t\t\t<CardIcon class=\"h-4 w-4\" />\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span>Current billing amount so far </span>\n\t\t\t\t\t\t\t<span class=\"text-gray-900 font-medium\">\n\t\t\t\t\t\t\t\t{{ currency }} {{ currentBillingAmount?.toFixed(2) || '0.00' }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Button variant=\"solid\" label=\"Upgrade plan\" @click=\"emit('changePlan')\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"unpaidAmount.data\"\n\t\t\t\tclass=\"flex justify-between items-center rounded-lg py-2 px-2.5 m-1.5 bg-gray-50\"\n\t\t\t>\n\t\t\t\t<div class=\"text-gray-800 flex items-center gap-2 h-7\">\n\t\t\t\t\t<UnPaidBillIcon class=\"h-4 w-4\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span>Unpaid amount is </span>\n\t\t\t\t\t\t<span>{{ currency }} {{ unpaidAmount.data?.toFixed(2) }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<Button variant=\"outline\" label=\"Pay now\" @click=\"payNow\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"flex items-start justify-center\">\n\t\t\t<Spinner class=\"h-4 w-4 text-gray-700\" />\n\t\t</div>\n\t\t<AddPrepaidCreditsModal\n\t\t\tv-if=\"showAddPrepaidCreditsModal\"\n\t\t\tv-model=\"showAddPrepaidCreditsModal\"\n\t\t\t@success=\"upcomingInvoice.reload()\"\n\t\t/>\n\t</div>\n</template>\n<script setup>\nimport CardIcon from '../icons/CardIcon.vue'\nimport UnPaidBillIcon from '../icons/UnPaidBillIcon.vue'\nimport PlanDetails from './PlanDetails.vue'\nimport AddPrepaidCreditsModal from './AddPrepaidCreditsModal.vue'\nimport { Button, Tooltip, Spinner, FeatherIcon, createResource } from 'frappe-ui'\nimport { calculateTrialEndDays } from '../utils.js'\nimport { ref, computed, inject } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { createDialog } from '../dialogs.js'\n\nconst emit = defineEmits(['changePlan'])\n\nconst router = useRouter()\n\nconst team = inject('team')\nconst currentSiteInfo = inject('currentSiteInfo')\nconst { currentBillingAmount, upcomingInvoice } = inject('billing')\n\nconst showAddPrepaidCreditsModal = ref(false)\n\nconst trialEndDays = ref(0)\nconst trialDescription = computed(() => {\n\treturn trialEndDays.value > 1\n\t\t? 'Your trial plan ends in ' + trialEndDays.value + ' days'\n\t\t: 'Your trial plan will end tomorrow'\n})\n\nconst price = ref(null)\nconst currency = computed(() => (team.data.currency == 'INR' ? '₹' : '$'))\n\nconst currentPlan = computed(() => {\n\tif (!currentSiteInfo.data) return null\n\ttrialEndDays.value = calculateTrialEndDays(currentSiteInfo.data.trial_end_date)\n\tlet _currentPlan = currentSiteInfo.data.plan\n\tprice.value = currency.value === '₹' ? _currentPlan.price_inr : _currentPlan.price_usd\n\treturn _currentPlan\n})\n\nconst unpaidAmount = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.total_unpaid_amount' },\n\tcache: 'unpaidAmount',\n\tauto: true,\n})\n\nconst currentMonthEnd = () => {\n\tconst date = new Date()\n\tconst lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0)\n\treturn lastDay.toLocaleDateString('en-US', {\n\t\tday: 'numeric',\n\t\tmonth: 'short',\n\t\tyear: 'numeric',\n\t})\n}\n\nconst unpaidInvoices = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.get_unpaid_invoices' },\n})\n\nfunction payNow() {\n\tteam.data.payment_mode == 'Prepaid Credits'\n\t\t? (showAddPrepaidCreditsModal.value = true)\n\t\t: payUnpaidInvoices()\n}\n\nasync function payUnpaidInvoices() {\n\tlet _unpaidInvoices = await unpaidInvoices.reload()\n\tif (_unpaidInvoices.length > 1) {\n\t\tcreateDialog({\n\t\t\ttitle: 'Multiple unpaid invoices',\n\t\t\tmessage: 'You have multiple unpaid invoices. Please pay them from the invoices page',\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Go to invoices',\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tonClick: (close) => {\n\t\t\t\t\t\trouter.push({ name: 'Invoices' })\n\t\t\t\t\t\tclose()\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t})\n\t} else {\n\t\tlet invoice = _unpaidInvoices\n\t\tif (invoice.stripe_invoice_url) {\n\t\t\twindow.open(invoice.stripe_invoice_url, '_blank')\n\t\t} else {\n\t\t\tcreateResource({\n\t\t\t\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\t\t\t\tparams: {\n\t\t\t\t\tmethod: 'billing.get_stripe_payment_url_for_invoice',\n\t\t\t\t\tdata: { name: invoice.name },\n\t\t\t\t},\n\t\t\t\tauto: true,\n\t\t\t\tonSuccess: (url) => window.open(url, '_blank'),\n\t\t\t})\n\t\t}\n\t}\n}\n</script>\n","<template>\n\t<Dialog v-model=\"show\" :options=\"{ title: 'Billing Details' }\">\n\t\t<template #body-content>\n\t\t\t<div v-if=\"showMessage\" class=\"inline-flex gap-1.5 text-base mb-5 text-gray-700\">\n\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t<span> Add billing details to your account before proceeding.</span>\n\t\t\t</div>\n\t\t\t<BillingDetails\n\t\t\t\tref=\"billingRef\"\n\t\t\t\t@success=\"\n\t\t\t\t\t() => {\n\t\t\t\t\t\tshow = false\n\t\t\t\t\t\temit('success')\n\t\t\t\t\t}\n\t\t\t\t\"\n\t\t\t/>\n\t\t</template>\n\t</Dialog>\n</template>\n<script setup>\nimport BillingDetails from './BillingDetails.vue'\nimport { FeatherIcon, Dialog } from 'frappe-ui'\nimport { ref } from 'vue'\n\nconst props = defineProps({\n\tshowMessage: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n})\nconst emit = defineEmits(['success'])\nconst show = defineModel()\nconst billingRef = ref(null)\n</script>\n","<template>\n\t<div>\n\t\t<Dialog\n\t\t\tv-model=\"show\"\n\t\t\t:options=\"{ title: 'Choose active card' }\"\n\t\t\t:disableOutsideClickToClose=\"confirmDialogOpened\"\n\t\t>\n\t\t\t<template #body-content>\n\t\t\t\t<div v-if=\"cards.data?.length\" class=\"flex flex-col gap-2.5\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"card in cards.data\"\n\t\t\t\t\t\t:key=\"card.name\"\n\t\t\t\t\t\tclass=\"flex gap-2 justify-between text-base text-gray-900 p-2.5 rounded hover:bg-gray-100\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t\t\t<component :is=\"cardBrandIcon(card.brand)\" class=\"size-7\" />\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1 h-7 font-medium\">\n\t\t\t\t\t\t\t\t\t<div>{{ card.name_on_card }}</div>\n\t\t\t\t\t\t\t\t\t<div>&middot;</div>\n\t\t\t\t\t\t\t\t\t<div>Card ending in ••••</div>\n\t\t\t\t\t\t\t\t\t<div>{{ card.last_4 }}</div>\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tv-if=\"card.is_default\"\n\t\t\t\t\t\t\t\t\t\tclass=\"ml-1.5\"\n\t\t\t\t\t\t\t\t\t\tlabel=\"Default\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\ttheme=\"green\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-gray-600\">\n\t\t\t\t\t\t\t\t\tExpiry\n\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\tcard.expiry_month < 10\n\t\t\t\t\t\t\t\t\t\t\t? `0${card.expiry_month}`\n\t\t\t\t\t\t\t\t\t\t\t: card.expiry_month\n\t\t\t\t\t\t\t\t\t}}/{{ card.expiry_year }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"cards.data.length > 1 && !card.is_default\">\n\t\t\t\t\t\t\t<Dropdown\n\t\t\t\t\t\t\t\t:options=\"[\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: 'Set as default',\n\t\t\t\t\t\t\t\t\t\tonClick: () => setAsDefault(card.name),\n\t\t\t\t\t\t\t\t\t\tcondition: () => !card.is_default,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{ label: 'Remove', onClick: () => removeCard(card.name) },\n\t\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Button icon=\"more-horizontal\" variant=\"ghost\" />\n\t\t\t\t\t\t\t</Dropdown>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template #actions>\n\t\t\t\t<Button\n\t\t\t\t\tlabel=\"Add new card\"\n\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t@click=\"emit('addCard')\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<FeatherIcon name=\"plus\" class=\"h-4\" />\n\t\t\t\t\t</template>\n\t\t\t\t</Button>\n\t\t\t</template>\n\t\t</Dialog>\n\t</div>\n</template>\n<script setup>\nimport { createDialog } from '../dialogs.js'\nimport { Dropdown, Badge, Dialog, Button, FeatherIcon, createResource } from 'frappe-ui'\nimport { cardBrandIcon } from '../utils.js'\nimport { ref } from 'vue'\n\nconst emit = defineEmits(['success', 'addCard'])\n\nconst show = defineModel()\n\nconst cards = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.get_payment_methods' },\n\tcache: 'cards',\n\tauto: true,\n})\n\nconst setAsDefault = (card) => {\n\tcreateResource({\n\t\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\t\tparams: { method: 'billing.set_as_default', data: { name: card } },\n\t\tauto: true,\n\t\tonSuccess: () => {\n\t\t\tcards.reload()\n\t\t\temit('success')\n\t\t},\n\t})\n}\n\nconst confirmDialogOpened = ref(false)\nconst removeCard = (card) => {\n\tconfirmDialogOpened.value = true\n\tcreateDialog({\n\t\ttitle: 'Remove Card',\n\t\tmessage: 'Are you sure you want to remove this card?',\n\t\tactions: [\n\t\t\t{\n\t\t\t\tlabel: 'Remove',\n\t\t\t\tvariant: 'solid',\n\t\t\t\ttheme: 'red',\n\t\t\t\tonClick: (close) => {\n\t\t\t\t\tcreateResource({\n\t\t\t\t\t\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tmethod: 'billing.remove_payment_method',\n\t\t\t\t\t\t\tdata: { name: card },\n\t\t\t\t\t\t},\n\t\t\t\t\t\tauto: true,\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tcards.reload()\n\t\t\t\t\t\t\tconfirmDialogOpened.value = false\n\t\t\t\t\t\t\tclose()\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\tonClose: () => {\n\t\t\tconfirmDialogOpened.value = false\n\t\t},\n\t})\n}\n</script>\n","<template>\n\t<div class=\"flex flex-col gap-4\">\n\t\t<div class=\"text-lg font-semibold text-gray-900\">\n\t\t\t{{ 'Payment details' }}\n\t\t</div>\n\t\t<div class=\"flex flex-col\">\n\t\t\t<div\n\t\t\t\tv-if=\"team.data.payment_mode == 'Card'\"\n\t\t\t\tclass=\"flex justify-between items-center text-base text-gray-900\"\n\t\t\t>\n\t\t\t\t<div class=\"flex flex-col gap-1.5\">\n\t\t\t\t\t<div class=\"font-medium\">{{ 'Active card' }}</div>\n\t\t\t\t\t<div class=\"overflow-hidden text-gray-700 text-ellipsis\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"team.data.payment_method\"\n\t\t\t\t\t\t\tclass=\"inline-flex items-center gap-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is=\"cardBrandIcon(team.data.payment_method.brand)\" />\n\t\t\t\t\t\t\t<div class=\"text-gray-700\">\n\t\t\t\t\t\t\t\t<span>{{ team.data.payment_method.name_on_card }}</span>\n\t\t\t\t\t\t\t\t<span> &middot; Card ending in •••• </span>\n\t\t\t\t\t\t\t\t<span>{{ team.data.payment_method.last_4 }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span v-else class=\"text-gray-700\">No card added</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:label=\"team.data.payment_method ? 'Change card' : 'Add card'\"\n\t\t\t\t\t\t@click=\"changeMethod\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-if=\"!team.data.payment_method\" #prefix>\n\t\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"plus\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"team.data.payment_mode == 'Card'\" class=\"bg-gray-100 h-px my-3\" />\n\t\t\t<div class=\"flex justify-between items-center text-base text-gray-900\">\n\t\t\t\t<div class=\"flex flex-col gap-1.5\">\n\t\t\t\t\t<div class=\"font-medium\">{{ 'Mode of payment' }}</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"team.data.payment_mode\"\n\t\t\t\t\t\tclass=\"inline-flex items-center gap-2 text-gray-700\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t\t\t{{ paymentMode.description }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<span v-else class=\"text-gray-700\">Not set</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t<Dropdown :options=\"paymentModeOptions\">\n\t\t\t\t\t\t<template #default=\"{ open }\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t:label=\"team.data.payment_mode ? paymentMode.label : 'Set mode'\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template #suffix>\n\t\t\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\t\t\t:name=\"open ? 'chevron-up' : 'chevron-down'\"\n\t\t\t\t\t\t\t\t\t\tclass=\"h-4\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Dropdown>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bg-gray-100 h-px my-3\" />\n\t\t\t<div class=\"flex justify-between items-center text-base text-gray-900\">\n\t\t\t\t<div class=\"flex flex-col gap-1.5\">\n\t\t\t\t\t<div class=\"font-medium\">{{ 'Credit balance' }}</div>\n\t\t\t\t\t<div class=\"text-gray-700\">\n\t\t\t\t\t\t{{ availableCredits || currency + ' 0.00' }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:label=\"'Add credit'\"\n\t\t\t\t\t\t@click=\"\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tshowMessage = false\n\t\t\t\t\t\t\t\tif (!billingDetailsSummary) {\n\t\t\t\t\t\t\t\t\tshowMessage = true\n\t\t\t\t\t\t\t\t\tshowBillingDetailsDialog = true\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tshowAddPrepaidCreditsModal = true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"plus\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bg-gray-100 h-px my-3\" />\n\t\t\t<div class=\"flex justify-between items-center text-base text-gray-900\">\n\t\t\t\t<div class=\"flex flex-col gap-1.5\">\n\t\t\t\t\t<div class=\"font-medium\">{{ 'Billing address' }}</div>\n\t\t\t\t\t<div v-if=\"billingDetailsSummary\" class=\"text-gray-700 leading-5\">\n\t\t\t\t\t\t{{ billingDetailsSummary }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else class=\"text-gray-700\">No address</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:label=\"billingDetailsSummary ? 'Edit information' : 'Add billing address'\"\n\t\t\t\t\t\t@click=\"\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tshowMessage = false\n\t\t\t\t\t\t\t\tshowBillingDetailsDialog = true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-if=\"!billingDetailsSummary\" #prefix>\n\t\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"plus\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<BillingDetailsModal\n\t\tv-if=\"showBillingDetailsDialog\"\n\t\tv-model=\"showBillingDetailsDialog\"\n\t\t:showMessage=\"showMessage\"\n\t\t@success=\"billingDetails.reload()\"\n\t/>\n\t<AddPrepaidCreditsModal\n\t\tv-if=\"showAddPrepaidCreditsModal\"\n\t\tv-model=\"showAddPrepaidCreditsModal\"\n\t\t:showMessage=\"showMessage\"\n\t\t@success=\"upcomingInvoice.reload()\"\n\t/>\n\t<AddCardModal\n\t\tv-if=\"showAddCardModal\"\n\t\tv-model=\"showAddCardModal\"\n\t\t:showMessage=\"showMessage\"\n\t\t@success=\"\n\t\t\t() => {\n\t\t\t\tshowMessage = false\n\t\t\t\tshowAddCardModal = false\n\t\t\t\tteam.reload()\n\t\t\t}\n\t\t\"\n\t/>\n\t<ChangeCardModal\n\t\tv-if=\"showChangeCardModal\"\n\t\tv-model=\"showChangeCardModal\"\n\t\t@addCard=\"\n\t\t\t() => {\n\t\t\t\tshowChangeCardModal = false\n\t\t\t\tshowAddCardModal = true\n\t\t\t}\n\t\t\"\n\t\t@success=\"() => team.reload()\"\n\t/>\n</template>\n<script setup>\nimport DropdownItem from './DropdownItem.vue'\nimport BillingDetailsModal from './BillingDetailsModal.vue'\nimport AddPrepaidCreditsModal from './AddPrepaidCreditsModal.vue'\nimport AddCardModal from './AddCardModal.vue'\nimport ChangeCardModal from './ChangeCardModal.vue'\nimport { Dropdown, Button, FeatherIcon, createResource } from 'frappe-ui'\nimport { cardBrandIcon } from '../utils.js'\nimport { computed, ref, inject, h } from 'vue'\n\nconst team = inject('team')\nconst { availableCredits, upcomingInvoice } = inject('billing')\n\nconst showBillingDetailsDialog = ref(false)\nconst showAddPrepaidCreditsModal = ref(false)\nconst showAddCardModal = ref(false)\nconst showChangeCardModal = ref(false)\n\nconst currency = computed(() => (team.data.currency == 'INR' ? '₹' : '$'))\n\nconst billingDetails = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.get_information' },\n\tcache: 'billingDetails',\n\tauto: true,\n})\n\nconst billingDetailsSummary = computed(() => {\n\tlet _billingDetails = billingDetails.data\n\tif (!_billingDetails) return ''\n\n\tconst { billing_name, address_line1, city, state, country, pincode, gstin } =\n\t\t_billingDetails || {}\n\treturn [billing_name, address_line1, city, state, country, pincode, gstin]\n\t\t.filter(Boolean)\n\t\t.join(', ')\n})\n\nconst paymentModeOptions = [\n\t{\n\t\tlabel: 'Card',\n\t\tvalue: 'Card',\n\t\tdescription: 'Your card will be charged for monthly subscription',\n\t\tcomponent: () =>\n\t\t\th(DropdownItem, {\n\t\t\t\tlabel: 'Card',\n\t\t\t\tactive: team.data.payment_mode === 'Card',\n\t\t\t\tonClick: () => updatePaymentMode('Card'),\n\t\t\t}),\n\t},\n\t{\n\t\tlabel: 'Prepaid credits',\n\t\tvalue: 'Prepaid Credits',\n\t\tdescription: 'You will be charged from your credit balance for monthly subscription',\n\t\tcomponent: () =>\n\t\t\th(DropdownItem, {\n\t\t\t\tlabel: 'Prepaid credits',\n\t\t\t\tactive: team.data.payment_mode === 'Prepaid Credits',\n\t\t\t\tonClick: () => updatePaymentMode('Prepaid Credits'),\n\t\t\t}),\n\t},\n]\n\nconst paymentMode = computed(() => {\n\treturn paymentModeOptions.find((o) => o.value === team.data.payment_mode)\n})\n\nconst showMessage = ref(false)\nfunction updatePaymentMode(mode) {\n\tshowMessage.value = false\n\tif (!billingDetailsSummary.value) {\n\t\tshowMessage.value = true\n\t\tshowBillingDetailsDialog.value = true\n\t\treturn\n\t}\n\tif (mode === 'Prepaid Credits' && team.data.balance === 0) {\n\t\tshowMessage.value = true\n\t\tshowAddPrepaidCreditsModal.value = true\n\t\treturn\n\t} else if (mode === 'Card' && !team.data.payment_method) {\n\t\tshowMessage.value = true\n\t\tshowAddCardModal.value = true\n\t}\n\tcreateResource({\n\t\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\t\tparams: {\n\t\t\tmethod: 'billing.change_payment_mode',\n\t\t\tdata: { mode },\n\t\t},\n\t\tauto: true,\n\t\tonSuccess: () => team.reload(),\n\t})\n}\n\nfunction changeMethod() {\n\tif (team.data.payment_method) {\n\t\tshowChangeCardModal.value = true\n\t} else {\n\t\tshowMessage.value = false\n\t\tshowAddCardModal.value = true\n\t}\n}\n</script>\n","<template>\n\t<header class=\"flex h-10.5 border-b items-center justify-between py-2 px-5 shrink-0\">\n\t\t<Breadcrumbs :items=\"[{ label: 'Billing Overview' }]\" />\n\t</header>\n\t<div v-if=\"team.data\" class=\"flex flex-1 flex-col px-60 pt-6 gap-8 overflow-y-auto\">\n\t\t<CurrentPlan @changePlan=\"router.push({ name: 'Plans' })\" />\n\t\t<PaymentDetails />\n\t</div>\n\t<div v-else class=\"flex flex-1 items-center justify-center\">\n\t\t<Spinner class=\"size-8\" />\n\t</div>\n</template>\n<script setup>\nimport CurrentPlan from '@/components/CurrentPlan.vue'\nimport PaymentDetails from '@/components/PaymentDetails.vue'\nimport { Spinner, createResource, Breadcrumbs } from 'frappe-ui'\nimport { useRouter } from 'vue-router'\nimport { computed, provide, inject } from 'vue'\n\nconst router = useRouter()\n\nconst team = inject('team')\n\nconst upcomingInvoice = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.upcoming_invoice' },\n\tcache: 'upcomingInvoice',\n\tauto: true,\n})\n\nprovide('billing', {\n\tupcomingInvoice,\n\tavailableCredits: computed(() => upcomingInvoice.data?.available_credits),\n\tcurrentBillingAmount: computed(() => upcomingInvoice.data?.upcoming_invoice?.total),\n})\n</script>\n"],"names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","emit","__emit","show","_useModel","__props","router","useRouter","team","inject","currentSiteInfo","currentBillingAmount","upcomingInvoice","showAddPrepaidCreditsModal","ref","trialEndDays","trialDescription","computed","price","currency","currentPlan","calculateTrialEndDays","_currentPlan","unpaidAmount","createResource","currentMonthEnd","date","unpaidInvoices","payNow","payUnpaidInvoices","_unpaidInvoices","createDialog","close","invoice","url","billingRef","cards","setAsDefault","card","confirmDialogOpened","removeCard","availableCredits","showBillingDetailsDialog","showAddCardModal","showChangeCardModal","billingDetails","billingDetailsSummary","_billingDetails","billing_name","address_line1","city","state","country","pincode","gstin","paymentModeOptions","h","DropdownItem","updatePaymentMode","paymentMode","o","showMessage","mode","changeMethod","provide","_a","_b"],"mappings":"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"}