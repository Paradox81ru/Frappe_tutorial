{"version":3,"file":"BillingDetails-71e8e074.js","sources":["../../../../billing/src/components/BuyCreditsStripe.vue","../../../../billing/src/components/BuyCreditsRazorpay.vue","../../../../billing/src/logo/RazorpayLogo.vue","../../../../billing/src/logo/StripeLogo.vue","../../../../billing/src/components/PrepaidCreditsForm.vue","../../../../billing/src/components/BillingDetails.vue"],"sourcesContent":["<template>\n\t<div>\n\t\t<label\n\t\t\tclass=\"block\"\n\t\t\t:class=\"{\n\t\t\t\t'pointer-events-none h-0.5 opacity-0': step != 'Add Card Details',\n\t\t\t\t'mt-4': step == 'Add Card Details',\n\t\t\t}\"\n\t\t>\n\t\t\t<span class=\"text-sm leading-4 text-gray-700\"> Credit or Debit Card </span>\n\t\t\t<div class=\"form-input mt-2 block w-full pl-3\" ref=\"cardElementRef\"></div>\n\t\t\t<ErrorMessage class=\"mt-1\" :message=\"cardErrorMessage\" />\n\t\t</label>\n\n\t\t<div v-if=\"step == 'Setting up Stripe'\" class=\"mt-8 flex justify-center\">\n\t\t\t<Spinner class=\"h-4 w-4 text-gray-700\" />\n\t\t</div>\n\t\t<ErrorMessage class=\"mt-2\" :message=\"createPaymentIntent.error || errorMessage\" />\n\t\t<div class=\"mt-8\">\n\t\t\t<Button\n\t\t\t\tv-if=\"step == 'Get Amount'\"\n\t\t\t\tclass=\"w-full\"\n\t\t\t\tsize=\"md\"\n\t\t\t\tvariant=\"solid\"\n\t\t\t\tlabel=\"Proceed to payment using Stripe\"\n\t\t\t\t:loading=\"createPaymentIntent.loading\"\n\t\t\t\t@click=\"createPaymentIntent.submit()\"\n\t\t\t/>\n\t\t\t<Button\n\t\t\t\tv-else-if=\"step == 'Add Card Details'\"\n\t\t\t\tclass=\"w-full\"\n\t\t\t\tsize=\"md\"\n\t\t\t\tvariant=\"solid\"\n\t\t\t\tlabel=\"Make payment via Stripe\"\n\t\t\t\t:loading=\"paymentInProgress\"\n\t\t\t\t@click=\"onBuyClick\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport { Button, ErrorMessage, Spinner, createResource, toast } from 'frappe-ui'\nimport { loadStripe } from '@stripe/stripe-js'\nimport { ref, nextTick, inject } from 'vue'\n\nconst props = defineProps({\n\tamount: {\n\t\ttype: Number,\n\t\tdefault: 0,\n\t},\n\tminimumAmount: {\n\t\ttype: Number,\n\t\tdefault: 0,\n\t},\n})\n\nconst emit = defineEmits(['success'])\n\nconst team = inject('team')\n\nconst step = ref('Get Amount')\nconst clientSecret = ref(null)\nconst cardErrorMessage = ref(null)\nconst errorMessage = ref(null)\nconst paymentInProgress = ref(false)\n\nconst stripe = ref(null)\nconst card = ref(null)\nconst elements = ref(null)\nconst ready = ref(false)\n\nconst cardElementRef = ref(null)\n\nconst createPaymentIntent = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: {\n\t\tmethod: 'billing.create_payment_intent_for_buying_credits',\n\t\tdata: { amount: props.amount },\n\t},\n\tvalidate() {\n\t\tif (props.amount < props.minimumAmount && !team.data.erpnext_partner) {\n\t\t\treturn `Amount must be greater than or equal to ${props.minimumAmount}`\n\t\t}\n\t},\n\tasync onSuccess(data) {\n\t\tstep.value = 'Setting up Stripe'\n\t\tlet { publishable_key, client_secret } = data\n\t\tclientSecret.value = client_secret\n\t\tstripe.value = await loadStripe(publishable_key)\n\t\telements.value = stripe.value.elements()\n\t\tconst style = {\n\t\t\tbase: {\n\t\t\t\tcolor: '#171717',\n\t\t\t\tfontFamily: [\n\t\t\t\t\t'ui-sans-serif',\n\t\t\t\t\t'system-ui',\n\t\t\t\t\t'-apple-system',\n\t\t\t\t\t'BlinkMacSystemFont',\n\t\t\t\t\t'\"Segoe UI\"',\n\t\t\t\t\t'Roboto',\n\t\t\t\t\t'\"Helvetica Neue\"',\n\t\t\t\t\t'Arial',\n\t\t\t\t\t'\"Noto Sans\"',\n\t\t\t\t\t'sans-serif',\n\t\t\t\t\t'\"Apple Color Emoji\"',\n\t\t\t\t\t'\"Segoe UI Emoji\"',\n\t\t\t\t\t'\"Segoe UI Symbol\"',\n\t\t\t\t\t'\"Noto Color Emoji\"',\n\t\t\t\t].join(', '),\n\t\t\t\tfontSmoothing: 'antialiased',\n\t\t\t\tfontSize: '13px',\n\t\t\t\t'::placeholder': {\n\t\t\t\t\tcolor: '#C7C7C7',\n\t\t\t\t},\n\t\t\t},\n\t\t\tinvalid: {\n\t\t\t\tcolor: '#7C7C7C',\n\t\t\t\ticonColor: '#7C7C7C',\n\t\t\t},\n\t\t}\n\t\tcard.value = elements.value.create('card', {\n\t\t\thidePostalCode: true,\n\t\t\tstyle: style,\n\t\t\tclasses: {\n\t\t\t\tcomplete: '',\n\t\t\t\tfocus: 'bg-gray-100',\n\t\t\t},\n\t\t})\n\n\t\tstep.value = 'Add Card Details'\n\t\tnextTick(() => {\n\t\t\tcard.value.mount(cardElementRef.value)\n\t\t})\n\n\t\tcard.value.addEventListener('change', (event) => {\n\t\t\tcardErrorMessage.value = event.error?.message || null\n\t\t})\n\t\tcard.value.addEventListener('ready', () => {\n\t\t\tready.value = true\n\t\t})\n\t},\n})\n\nasync function onBuyClick() {\n\tpaymentInProgress.value = true\n\tlet payload = await stripe.value.confirmCardPayment(clientSecret.value, {\n\t\tpayment_method: { card: card.value },\n\t})\n\n\tif (payload.error) {\n\t\terrorMessage.value = payload.error.message\n\t\tpaymentInProgress.value = false\n\t} else {\n\t\ttoast({\n\t\t\tposition: 'bottom-right',\n\t\t\ttitle: 'Payment successful',\n\t\t\ttext: 'Payment processed successfully, we will update your account shortly on confirmation from Stripe',\n\t\t\ticon: 'check',\n\t\t\ticonClasses: 'text-green-600',\n\t\t\ttimeout: 10,\n\t\t})\n\t\tpaymentInProgress.value = false\n\t\temit('success')\n\t\terrorMessage.value = null\n\t}\n}\n</script>\n","<template>\n\t<div>\n\t\t<span\n\t\t\tv-if=\"team.data.currency === 'INR'\"\n\t\t\tclass=\"mt-2.5 inline-flex gap-2 text-base text-gray-700\"\n\t\t>\n\t\t\t<FeatherIcon name=\"info\" class=\"h-4 my-1\" />\n\t\t\t<span class=\"leading-5\">\n\t\t\t\tIf you select Razorpay, you can pay using Credit Card, Debit Card, Net Banking,\n\t\t\t\tUPI, Wallets, etc. If you are using Net Banking, it may take upto 5 days for\n\t\t\t\tbalance to reflect.\n\t\t\t</span>\n\t\t</span>\n\t\t<ErrorMessage class=\"mt-3\" :message=\"createRazorpayOrder.error\" />\n\t\t<div class=\"mt-8\">\n\t\t\t<Button\n\t\t\t\tv-if=\"!isPaymentComplete\"\n\t\t\t\tclass=\"w-full\"\n\t\t\t\tsize=\"md\"\n\t\t\t\tvariant=\"solid\"\n\t\t\t\tlabel=\"Proceed to payment using Razorpay\"\n\t\t\t\t:loading=\"createRazorpayOrder.loading\"\n\t\t\t\t@click=\"createRazorpayOrder.submit()\"\n\t\t\t/>\n\t\t\t<Button\n\t\t\t\tv-else\n\t\t\t\tclass=\"w-full\"\n\t\t\t\tsize=\"md\"\n\t\t\t\tlabel=\"Confirming payment\"\n\t\t\t\tvariant=\"solid\"\n\t\t\t\t:loading=\"isVerifyingPayment\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport { Button, ErrorMessage, FeatherIcon, createResource, toast } from 'frappe-ui'\nimport { ref, onMounted, onBeforeUnmount, inject } from 'vue'\n\nconst props = defineProps({\n\tamount: {\n\t\ttype: Number,\n\t\tdefault: 0,\n\t},\n\tminimumAmount: {\n\t\ttype: Number,\n\t\tdefault: 0,\n\t},\n})\n\nconst emit = defineEmits(['success'])\nconst team = inject('team')\n\nconst isPaymentComplete = ref(false)\nconst isVerifyingPayment = ref(false)\n\nconst razorpayCheckoutJS = ref(null)\n\nonMounted(() => {\n\trazorpayCheckoutJS.value = document.createElement('script')\n\trazorpayCheckoutJS.value.setAttribute('src', 'https://checkout.razorpay.com/v1/checkout.js')\n\trazorpayCheckoutJS.value.async = true\n\tdocument.head.appendChild(razorpayCheckoutJS.value)\n})\n\nonBeforeUnmount(() => {\n\trazorpayCheckoutJS.value?.remove()\n})\n\nconst createRazorpayOrder = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: {\n\t\tmethod: 'billing.create_razorpay_order',\n\t\tdata: { amount: props.amount },\n\t},\n\tonSuccess: (data) => processOrder(data),\n\tvalidate: () => {\n\t\tif (props.amount < props.minimumAmount) {\n\t\t\treturn 'Amount less than minimum amount required'\n\t\t}\n\t},\n})\n\nconst handlePaymentFailed = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.handle_razorpay_payment_failed' },\n\tonSuccess: () => {\n\t\tconsole.log('Payment Failed.')\n\t},\n})\n\nfunction processOrder(data) {\n\tconst options = {\n\t\tkey: data.key_id,\n\t\torder_id: data.order_id,\n\t\tname: 'Frappe Cloud',\n\t\timage: 'https://frappe.io/files/cloud.png',\n\t\tprefill: { email: team.data?.user },\n\t\thandler: handlePaymentSuccess,\n\t\ttheme: { color: '#171717' },\n\t}\n\n\tconst rzp = new Razorpay(options)\n\n\t// Opens the payment checkout frame\n\trzp.open()\n\n\t// Attach failure handler\n\trzp.on('payment.failed', handlePaymentFailure)\n\t// rzp.on('payment.success', this.handlePaymentSuccess);\n}\n\nfunction handlePaymentFailure(response) {\n\thandlePaymentFailed.submit({ response })\n\ttoast({\n\t\ttitle: 'Payment failed',\n\t\ticon: 'x',\n\t\ticonClasses: 'text-red-600',\n\t\tposition: 'bottom-right',\n\t})\n}\n\nfunction handlePaymentSuccess() {\n\tisPaymentComplete.value = true\n\temit('success')\n\ttoast({\n\t\ttitle: 'Payment successful',\n\t\ticon: 'check',\n\t\ticonClasses: 'text-green-600',\n\t\tposition: 'bottom-right',\n\t})\n}\n</script>\n","<template>\n\t<svg\n\t\twidth=\"847\"\n\t\theight=\"180\"\n\t\tviewBox=\"0 0 847 180\"\n\t\tfill=\"none\"\n\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t>\n\t\t<path\n\t\t\td=\"M223.833 67.1063C226.646 56.5688 225.484 48.5063 220.345 42.9188C215.207 37.3313 206.224 34.5188 193.398 34.4813H144.247L114.617 145.65H138.414L150.397 100.65H166.112C168.987 100.506 171.852 101.093 174.438 102.356C175.488 103.013 176.363 103.913 176.99 104.981C177.617 106.048 177.977 107.251 178.039 108.488L182.333 145.65H207.837L203.674 111.131C202.849 103.425 199.305 98.8876 193.154 97.5189C200.596 95.4659 207.387 91.5412 212.882 86.1189C218.191 80.893 221.977 74.3204 223.833 67.1063ZM201.049 67.5001C200.023 72.0579 197.231 76.0227 193.285 78.5251C189.534 80.8876 184.059 82.0501 177.101 82.0501H155.011L162.774 53.0063H184.884C191.822 53.0063 196.586 54.1876 199.211 56.5313C201.836 58.8751 202.399 62.5876 201.049 67.5001Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M292.544 66.1875L289.524 77.4375C288.266 73.4169 285.604 69.9828 282.023 67.7625C277.847 65.2563 273.032 64.0185 268.165 64.2C261.337 64.2018 254.627 65.9856 248.7 69.375C242.248 73.0744 236.676 78.1279 232.366 84.1875C227.616 90.7391 224.137 98.1228 222.108 105.956C219.98 112.928 219.53 120.303 220.795 127.481C221.761 133.151 224.795 138.261 229.309 141.825C234.216 145.333 240.161 147.09 246.187 146.813C251.568 146.825 256.888 145.673 261.782 143.437C266.676 141.2 271.028 137.932 274.541 133.856L271.428 145.594H294.625L315.778 66.1875H292.544ZM282.005 105.563C280.57 112.028 277.377 117.972 272.778 122.738C270.798 124.676 268.451 126.201 265.876 127.225C263.3 128.248 260.547 128.75 257.776 128.7C251.869 128.7 247.893 126.825 245.755 122.831C243.618 118.838 243.561 113.269 245.512 105.956C246.995 99.433 250.238 93.441 254.888 88.6313C256.875 86.6345 259.24 85.0539 261.845 83.9819C264.45 82.9098 267.242 82.3678 270.059 82.3875C275.835 82.3875 279.773 84.3938 281.798 88.3875C283.824 92.3813 284.03 98.025 282.042 105.544L282.005 105.563Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M398.534 66.2437H331.718L326.786 84.7687H365.679L314.54 129.375L310.171 145.744H379.181L384.113 127.219H342.388L394.371 81.9749L398.534 66.2437Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M471.614 69.1501C465.409 65.605 458.332 63.8766 451.192 64.1626C443.138 64.0929 435.167 65.7956 427.845 69.1501C420.723 72.4705 414.465 77.3925 409.561 83.5314C404.438 89.9708 400.738 97.4217 398.703 105.394C396.514 112.484 396.243 120.027 397.915 127.256C399.45 133.257 403.264 138.423 408.548 141.656C413.924 144.969 420.8 146.625 429.176 146.625C437.144 146.695 445.028 144.998 452.261 141.656C459.361 138.335 465.589 133.405 470.451 127.256C475.584 120.821 479.291 113.369 481.328 105.394C483.521 98.3039 483.786 90.7579 482.097 83.5314C480.62 77.5504 476.856 72.387 471.614 69.1501ZM458.074 105.356C455.993 113.156 452.936 119.006 448.81 122.869C444.829 126.661 439.512 128.73 434.014 128.625C421.888 128.625 417.893 120.869 422.031 105.356C424.069 97.6564 427.195 91.8501 431.408 87.9376C435.44 84.0812 440.831 81.9721 446.41 82.0689C452.186 82.0689 456.124 83.9439 458.149 87.9376C460.175 91.9314 460.118 97.6501 458.074 105.356Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M724.213 66.1875L721.194 77.4375C719.936 73.4169 717.274 69.9828 713.693 67.7625C709.524 65.2336 704.708 63.9759 699.835 64.1438C692.995 64.1586 686.278 65.962 680.351 69.375C673.894 73.0736 668.315 78.1271 663.998 84.1875C659.256 90.7434 655.777 98.1257 653.74 105.956C651.631 112.931 651.181 120.302 652.428 127.481C653.394 133.151 656.427 138.261 660.942 141.825C665.913 145.362 671.932 147.119 678.025 146.813C683.286 146.793 688.483 145.655 693.271 143.475C698.212 141.258 702.599 137.973 706.117 133.856L703.004 145.594H726.201L747.373 66.1875H724.213ZM713.618 105.563C712.19 112.026 709.004 117.97 704.41 122.738C702.426 124.67 700.079 126.191 697.504 127.215C694.93 128.238 692.178 128.743 689.408 128.7C683.482 128.7 679.507 126.825 677.369 122.831C675.231 118.838 675.194 113.269 677.125 105.956C678.616 99.4361 681.858 93.4461 686.502 88.6313C688.493 86.6357 690.862 85.056 693.469 83.9841C696.077 82.9122 698.872 82.3695 701.691 82.3875C707.467 82.3875 711.38 84.3875 713.431 88.3875C715.606 92.2688 715.662 98.025 713.618 105.544V105.563Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M554.182 87.5628L560.108 65.9441C557.609 64.8129 554.88 64.28 552.138 64.3878C546.778 64.3939 541.509 65.7755 536.836 68.4003C532.574 70.7348 528.875 73.973 525.997 77.8878L529.053 66.2441H505.875L484.534 145.65H508.05L519.096 104.194C520.39 98.6623 523.419 93.6891 527.741 90.0003C532.185 86.5295 537.707 84.7309 543.343 84.9191C547.118 84.9033 550.839 85.8109 554.182 87.5628Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M636.132 69.5437C631.334 65.8774 625.4 64.0126 619.367 64.275C613.497 64.2816 607.712 65.6825 602.49 68.3625C597.257 70.9353 592.746 74.7691 589.363 79.5187L589.457 78.975L593.413 66.2437H570.348L564.459 88.3125C564.459 88.5562 564.328 88.8187 564.272 89.0625L540.081 180H563.709L575.917 134.175C577.084 138.218 579.773 141.652 583.418 143.756C587.649 146.186 592.476 147.382 597.352 147.206C604.201 147.225 610.946 145.523 616.967 142.256C623.375 138.725 628.906 133.797 633.151 127.837C637.82 121.319 641.235 113.987 643.221 106.219C645.364 99.143 645.852 91.6692 644.646 84.375C643.659 78.5774 640.641 73.3201 636.132 69.5437ZM619.424 105.844C617.982 112.207 614.809 118.047 610.253 122.719C606.222 126.574 600.829 128.677 595.251 128.569C589.438 128.569 585.5 126.562 583.418 122.606C581.337 118.65 581.224 112.95 583.268 105.431C584.729 98.9159 587.976 92.9362 592.645 88.1625C594.628 86.2258 596.974 84.699 599.548 83.6695C602.123 82.64 604.875 82.1279 607.647 82.1625C613.273 82.1625 617.192 84.2625 619.236 88.4062C621.28 92.55 621.411 98.4187 619.424 105.844Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M846.013 63.5999H821.634L817.884 71.4374C817.584 71.8311 817.302 72.2249 816.965 72.7124L816.571 73.3499L786.566 115.312L780.341 66.2436H755.737L768.245 141.506L740.585 180H764.269L771.114 170.231C771.321 169.931 771.527 169.687 771.714 169.369L779.722 157.95L779.984 157.65L815.746 106.631L846.013 63.5999Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M54.3828 47.1751L47.2567 73.1251L87.4627 47.0438L61.2088 145.65H87.8565L126.656 6.10352e-05L54.3828 47.1751Z\"\n\t\t\tfill=\"#3395FF\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M11.0641 104.175L0 145.65H54.6643L77.0364 61.2748L11.0641 104.175Z\"\n\t\t\tfill=\"#0C2651\"\n\t\t/>\n\t</svg>\n</template>\n","<template>\n\t<svg\n\t\tversion=\"1.1\"\n\t\tid=\"Layer_1\"\n\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\txmlns:xlink=\"http://www.w3.org/1999/xlink\"\n\t\tx=\"0px\"\n\t\ty=\"0px\"\n\t\tviewBox=\"0 0 468 222.5\"\n\t\tstyle=\"enable-background: new 0 0 468 222.5\"\n\t\txml:space=\"preserve\"\n\t>\n\t\t<g>\n\t\t\t<path\n\t\t\t\tfill=\"#635bff\"\n\t\t\t\td=\"M414,113.4c0-25.6-12.4-45.8-36.1-45.8c-23.8,0-38.2,20.2-38.2,45.6c0,30.1,17,45.3,41.4,45.3\n\t\tc11.9,0,20.9-2.7,27.7-6.5v-20c-6.8,3.4-14.6,5.5-24.5,5.5c-9.7,0-18.3-3.4-19.4-15.2h48.9C413.8,121,414,115.8,414,113.4z\n\t\t M364.6,103.9c0-11.3,6.9-16,13.2-16c6.1,0,12.6,4.7,12.6,16H364.6z\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill=\"#635bff\"\n\t\t\t\td=\"M301.1,67.6c-9.8,0-16.1,4.6-19.6,7.8l-1.3-6.2h-22v116.6l25-5.3l0.1-28.3c3.6,2.6,8.9,6.3,17.7,6.3\n\t\tc17.9,0,34.2-14.4,34.2-46.1C335.1,83.4,318.6,67.6,301.1,67.6z M295.1,136.5c-5.9,0-9.4-2.1-11.8-4.7l-0.1-37.1\n\t\tc2.6-2.9,6.2-4.9,11.9-4.9c9.1,0,15.4,10.2,15.4,23.3C310.5,126.5,304.3,136.5,295.1,136.5z\"\n\t\t\t/>\n\t\t\t<polygon fill=\"#635bff\" points=\"223.8,61.7 248.9,56.3 248.9,36 223.8,41.3 \t\" />\n\t\t\t<rect x=\"223.8\" y=\"69.3\" fill=\"#635bff\" width=\"25.1\" height=\"87.5\" />\n\t\t\t<path\n\t\t\t\tfill=\"#635bff\"\n\t\t\t\td=\"M196.9,76.7l-1.6-7.4h-21.6v87.5h25V97.5c5.9-7.7,15.9-6.3,19-5.2v-23C214.5,68.1,202.8,65.9,196.9,76.7z\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill=\"#635bff\"\n\t\t\t\td=\"M146.9,47.6l-24.4,5.2l-0.1,80.1c0,14.8,11.1,25.7,25.9,25.7c8.2,0,14.2-1.5,17.5-3.3V135\n\t\tc-3.2,1.3-19,5.9-19-8.9V90.6h19V69.3h-19L146.9,47.6z\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill=\"#635bff\"\n\t\t\t\td=\"M79.3,94.7c0-3.9,3.2-5.4,8.5-5.4c7.6,0,17.2,2.3,24.8,6.4V72.2c-8.3-3.3-16.5-4.6-24.8-4.6\n\t\tC67.5,67.6,54,78.2,54,95.9c0,27.6,38,23.2,38,35.1c0,4.6-4,6.1-9.6,6.1c-8.3,0-18.9-3.4-27.3-8v23.8c9.3,4,18.7,5.7,27.3,5.7\n\t\tc20.8,0,35.1-10.3,35.1-28.2C117.4,100.6,79.3,105.9,79.3,94.7z\"\n\t\t\t/>\n\t\t</g>\n\t</svg>\n</template>\n","<template>\n\t<div>\n\t\t<!-- Amount -->\n\t\t<div>\n\t\t\t<FormControl\n\t\t\t\t:label=\"`Amount (Minimum Amount: ${minimumAmount})`\"\n\t\t\t\tclass=\"mb-3\"\n\t\t\t\tv-model.number=\"creditsToBuy\"\n\t\t\t\tname=\"amount\"\n\t\t\t\tautocomplete=\"off\"\n\t\t\t\ttype=\"number\"\n\t\t\t\t:min=\"minimumAmount\"\n\t\t\t>\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<div class=\"grid w-4 place-items-center text-sm text-gray-700\">\n\t\t\t\t\t\t{{ team.data.currency === 'INR' ? '₹' : '$' }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</FormControl>\n\t\t\t<FormControl\n\t\t\t\tv-if=\"team.data.currency === 'INR'\"\n\t\t\t\t:label=\"`Total Amount + GST (${team.data?.billing_info.gst_percentage * 100}%)`\"\n\t\t\t\tdisabled\n\t\t\t\t:modelValue=\"totalAmount\"\n\t\t\t\tname=\"total\"\n\t\t\t\tautocomplete=\"off\"\n\t\t\t\ttype=\"number\"\n\t\t\t>\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<div class=\"grid w-4 place-items-center text-sm text-gray-700\">\n\t\t\t\t\t\t{{ team.data.currency === 'INR' ? '₹' : '$' }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</FormControl>\n\t\t</div>\n\n\t\t<!-- Payment Gateway -->\n\t\t<div class=\"mt-4\">\n\t\t\t<div class=\"text-xs text-gray-600\">Select Payment Gateway</div>\n\t\t\t<div class=\"mt-1.5 grid grid-cols-1 gap-2 sm:grid-cols-2\">\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"team.data.currency === 'INR' || team.data.razorpay_enabled\"\n\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'border-gray-700 border-[1.5px]': paymentGateway === 'Razorpay',\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"paymentGateway = 'Razorpay'\"\n\t\t\t\t>\n\t\t\t\t\t<RazorpayLogo class=\"w-24\" />\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'border-gray-700 border-[1.5px]': paymentGateway === 'Stripe',\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"paymentGateway = 'Stripe'\"\n\t\t\t\t>\n\t\t\t\t\t<StripeLogo class=\"h-7 w-24\" />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Payment Button -->\n\t\t<BuyCreditsStripe\n\t\t\tv-if=\"paymentGateway === 'Stripe'\"\n\t\t\t:amount=\"creditsToBuy\"\n\t\t\t:minimumAmount=\"minimumAmount\"\n\t\t\t@success=\"() => emit('success')\"\n\t\t\t@cancel=\"show = false\"\n\t\t/>\n\n\t\t<BuyCreditsRazorpay\n\t\t\tv-if=\"paymentGateway === 'Razorpay'\"\n\t\t\t:amount=\"creditsToBuy\"\n\t\t\t:minimumAmount=\"minimumAmount\"\n\t\t\t@success=\"() => emit('success')\"\n\t\t\t@cancel=\"show = false\"\n\t\t/>\n\t</div>\n</template>\n<script setup>\nimport BuyCreditsStripe from './BuyCreditsStripe.vue'\nimport BuyCreditsRazorpay from './BuyCreditsRazorpay.vue'\nimport RazorpayLogo from '../logo/RazorpayLogo.vue'\nimport StripeLogo from '../logo/StripeLogo.vue'\nimport { FormControl, Button, createResource } from 'frappe-ui'\nimport { ref, computed, inject } from 'vue'\n\nconst emit = defineEmits(['success'])\n\nconst team = inject('team')\n\nconst totalUnpaidAmount = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.total_unpaid_amount' },\n\tcache: 'totalUnpaidAmount',\n\tauto: true,\n})\n\nconst minimumAmount = computed(() => {\n\tif (!team.data) return 0\n\tconst unpaidAmount = totalUnpaidAmount.data || 0\n\tconst minimumDefault = team.data?.currency == 'INR' ? 410 : 5\n\n\treturn Math.ceil(unpaidAmount && unpaidAmount > 0 ? unpaidAmount : minimumDefault)\n})\n\nconst creditsToBuy = ref(minimumAmount.value)\nconst paymentGateway = ref('')\n\nconst totalAmount = computed(() => {\n\tlet _creditsToBuy = creditsToBuy.value || 0\n\tif (team.data?.currency === 'INR') {\n\t\treturn (\n\t\t\t_creditsToBuy +\n\t\t\t_creditsToBuy * (team.data.billing_info.gst_percentage || 0)\n\t\t).toFixed(2)\n\t} else {\n\t\treturn _creditsToBuy\n\t}\n})\n</script>\n","<template>\n\t<div class=\"flex flex-col gap-5\">\n\t\t<FormControl\n\t\t\tv-model=\"billingInformation.billing_name\"\n\t\t\ttype=\"text\"\n\t\t\tname=\"billing_name\"\n\t\t\tlabel=\"Billing Name\"\n\t\t\t:required=\"true\"\n\t\t/>\n\t\t<AddressForm\n\t\t\tref=\"addressFormRef\"\n\t\t\tv-model=\"billingInformation\"\n\t\t\t@success=\"() => emit('success')\"\n\t\t/>\n\t\t<ErrorMessage class=\"mt-2\" :message=\"errorMessage\" />\n\t</div>\n\t<div v-if=\"addressFormRef\" class=\"mt-6\">\n\t\t<Button\n\t\t\tclass=\"w-full\"\n\t\t\tvariant=\"solid\"\n\t\t\tlabel=\"Update billing details\"\n\t\t\t:loading=\"addressFormRef.updateBillingInformation.loading\"\n\t\t\t@click=\"updateBillingInformation\"\n\t\t/>\n\t</div>\n</template>\n<script setup>\nimport AddressForm from './AddressForm.vue'\nimport { FormControl, ErrorMessage, Button, createResource } from 'frappe-ui'\nimport { reactive, ref } from 'vue'\n\nconst emit = defineEmits(['success'])\n\nconst addressFormRef = ref(null)\n\nconst billingInformation = reactive({\n\tbilling_name: '',\n\taddress: '',\n\tcity: '',\n\tstate: '',\n\tpostal_code: '',\n\tcountry: '',\n\tgstin: '',\n})\n\ncreateResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.get_information' },\n\tauto: true,\n\tonSuccess: (data) => {\n\t\tObject.assign(billingInformation, {\n\t\t\taddress: data.address_line1,\n\t\t\tcity: data.city,\n\t\t\tstate: data.state,\n\t\t\tpostal_code: data.pincode,\n\t\t\tcountry: data.country,\n\t\t\tgstin: data.gstin == 'Not Applicable' ? '' : data.gstin,\n\t\t\tbilling_name: data.billing_name,\n\t\t})\n\t},\n})\n\nconst errorMessage = ref('')\n\nfunction updateBillingInformation() {\n\tif (!billingInformation.billing_name) {\n\t\terrorMessage.value = 'Billing Name is required'\n\t\treturn\n\t}\n\taddressFormRef.value.updateBillingInformation.submit()\n}\n</script>\n"],"names":["props","__props","emit","__emit","team","inject","step","ref","clientSecret","cardErrorMessage","errorMessage","paymentInProgress","stripe","card","elements","ready","cardElementRef","createPaymentIntent","createResource","data","publishable_key","client_secret","loadStripe","style","nextTick","event","_a","onBuyClick","payload","toast","isPaymentComplete","isVerifyingPayment","razorpayCheckoutJS","onMounted","onBeforeUnmount","createRazorpayOrder","processOrder","handlePaymentFailed","options","handlePaymentSuccess","rzp","handlePaymentFailure","response","_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","totalUnpaidAmount","minimumAmount","computed","unpaidAmount","minimumDefault","creditsToBuy","paymentGateway","totalAmount","_creditsToBuy","addressFormRef","billingInformation","reactive","updateBillingInformation"],"mappings":"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"}