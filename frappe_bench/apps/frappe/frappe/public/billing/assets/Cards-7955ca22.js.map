{"version":3,"file":"Cards-7955ca22.js","sources":["../../../../billing/src/icons/RefreshIcon.vue","../../../../billing/src/pages/Cards.vue"],"sourcesContent":["<template>\n\t<svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 16 16\">\n\t\t<g class=\"es-line-reload\" clip-path=\"url(#a)\">\n\t\t\t<path\n\t\t\t\tfill=\"currentColor\"\n\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\td=\"M9.743 2.189a6 6 0 0 0-6.558 2.596.5.5 0 0 0 .844.535 5 5 0 0 1 9.12 1.683l-1.187-.686a.5.5 0 0 0-.5.866l2.165 1.25a.5.5 0 0 0 .683-.183l1.25-2.165a.5.5 0 0 0-.866-.5l-.603 1.044a6 6 0 0 0-4.348-4.44ZM3.356 9.024l1.189.687a.5.5 0 0 0 .5-.866L2.88 7.595a.5.5 0 0 0-.683.183L.947 9.943a.5.5 0 1 0 .866.5l.603-1.044a6 6 0 0 0 10.9 1.816.5.5 0 0 0-.844-.536 5 5 0 0 1-9.116-1.655Z\"\n\t\t\t\tclass=\"Union\"\n\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t/>\n\t\t</g>\n\t\t<defs>\n\t\t\t<clipPath id=\"a\" class=\"a\">\n\t\t\t\t<path fill=\"currentColor\" d=\"M.25 0h16v16h-16z\" />\n\t\t\t</clipPath>\n\t\t</defs>\n\t</svg>\n</template>\n","<template>\n\t<header class=\"flex h-10.5 border-b items-center justify-between py-2 px-5 shrink-0\">\n\t\t<Breadcrumbs :items=\"[{ label: 'Cards' }]\" />\n\t</header>\n\t<div class=\"flex flex-col overflow-hidden mx-60 mt-6\">\n\t\t<div class=\"flex justify-end gap-2 mb-3\">\n\t\t\t<Button :loading=\"cards.loading\" @click=\"cards.reload()\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<RefreshIcon class=\"h-4 w-4\" />\n\t\t\t\t</template>\n\t\t\t</Button>\n\t\t\t<Button label=\"Add Card\" variant=\"solid\" @click=\"showAddCardModal = true\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<FeatherIcon name=\"plus\" class=\"h-4 w-4\" />\n\t\t\t\t</template>\n\t\t\t</Button>\n\t\t</div>\n\t\t<ListView\n\t\t\t:columns=\"columns\"\n\t\t\t:rows=\"rows\"\n\t\t\trow-key=\"id\"\n\t\t\t:options=\"{\n\t\t\t\tselectable: false,\n\t\t\t\tshowTooltip: false,\n\t\t\t}\"\n\t\t>\n\t\t\t<ListHeader />\n\t\t\t<ListRows v-if=\"rows.length\">\n\t\t\t\t<ListRow v-for=\"row in rows\" :key=\"row.id\" v-slot=\"{ column, item }\" :row=\"row\">\n\t\t\t\t\t<ListRowItem :item=\"item\" :align=\"column.align\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"column.key == 'last_4'\"\n\t\t\t\t\t\t\tclass=\"flex items-center gap-2 text-base\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is=\"cardBrandIcon(item.brand)\" class=\"h-6 w-6\" />\n\t\t\t\t\t\t\t<div>{{ item.last_4 }}</div>\n\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\tv-if=\"item.default\"\n\t\t\t\t\t\t\t\tlabel=\"Default\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\ttheme=\"green\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Dropdown\n\t\t\t\t\t\t\tv-else-if=\"column.key == 'actions' && !item.is_default\"\n\t\t\t\t\t\t\t:options=\"item.options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex items-center rounded bg-gray-100 px-1 py-0.5 hover:bg-gray-200\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"more-horizontal\" class=\"h-4 w-4\" />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Dropdown>\n\t\t\t\t\t</ListRowItem>\n\t\t\t\t</ListRow>\n\t\t\t</ListRows>\n\t\t\t<div v-else class=\"h-60 border border-dashed rounded\">\n\t\t\t\t<div class=\"flex flex-col gap-2 items-center justify-center h-full\">\n\t\t\t\t\t<p class=\"text-lg text-gray-500\">No card found</p>\n\t\t\t\t\t<Button label=\"Add Card\" variant=\"outline\" @click=\"showAddCardModal = true\">\n\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t<FeatherIcon name=\"plus\" class=\"h-4 w-4\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ListView>\n\t</div>\n\t<AddCardModal\n\t\tv-if=\"showAddCardModal\"\n\t\tv-model=\"showAddCardModal\"\n\t\t@success=\"\n\t\t\t() => {\n\t\t\t\tshowAddCardModal = false\n\t\t\t\tcards.reload()\n\t\t\t}\n\t\t\"\n\t/>\n</template>\n<script setup>\nimport AddCardModal from '@/components/AddCardModal.vue'\nimport RefreshIcon from '@/icons/RefreshIcon.vue'\nimport {\n\tListView,\n\tListHeader,\n\tListRows,\n\tListRow,\n\tListRowItem,\n\tDropdown,\n\tButton,\n\tBadge,\n\tTooltip,\n\tFeatherIcon,\n\tcreateResource,\n\tBreadcrumbs,\n} from 'frappe-ui'\nimport { useTimeAgo } from '@vueuse/core'\nimport { createDialog } from '@/dialogs.js'\nimport { cardBrandIcon } from '@/utils'\nimport { ref, computed } from 'vue'\n\nconst showAddCardModal = ref(false)\n\nconst cards = createResource({\n\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\tparams: { method: 'billing.get_payment_methods' },\n\tcache: 'cards',\n\tauto: true,\n})\n\nconst columns = [\n\t{\n\t\tlabel: 'Name on Card',\n\t\tkey: 'name_on_card',\n\t},\n\t{\n\t\tlabel: 'Card',\n\t\tkey: 'last_4',\n\t\twidth: 1.3,\n\t},\n\t{\n\t\tlabel: 'Expiry',\n\t\tkey: 'expiry_month',\n\t\twidth: 0.7,\n\t},\n\t{\n\t\tlabel: 'Mandated',\n\t\tkey: 'stripe_mandate_id',\n\t\talign: 'center',\n\t\twidth: 0.5,\n\t},\n\t{\n\t\tlabel: '',\n\t\tkey: 'alert',\n\t\talign: 'right',\n\t\twidth: 0.3,\n\t},\n\t{\n\t\tlabel: '',\n\t\tkey: 'creation',\n\t\talign: 'right',\n\t\twidth: 0.7,\n\t},\n\t{\n\t\tlabel: '',\n\t\tkey: 'actions',\n\t\talign: 'right',\n\t\twidth: 0.3,\n\t},\n]\n\nconst rows = computed(() => {\n\tif (!cards.data) return []\n\treturn cards.data.map((card) => {\n\t\treturn {\n\t\t\tid: card.name,\n\t\t\tname_on_card: card.name_on_card,\n\t\t\tlast_4: {\n\t\t\t\tbrand: card.brand,\n\t\t\t\tlast_4: `•••• ${card.last_4}`,\n\t\t\t\tdefault: card.is_default,\n\t\t\t},\n\t\t\texpiry_month: `${\n\t\t\t\tcard.expiry_month < 10 ? `0${card.expiry_month}` : card.expiry_month\n\t\t\t}/${card.expiry_year}`,\n\t\t\tstripe_mandate_id: card.stripe_mandate_id\n\t\t\t\t? h(FeatherIcon, {\n\t\t\t\t\t\tname: 'check-circle',\n\t\t\t\t\t\tclass: 'h-4 w-4 text-green-600',\n\t\t\t\t  })\n\t\t\t\t: null,\n\t\t\talert:\n\t\t\t\tcard.is_default && card.stripe_payment_method\n\t\t\t\t\t? h(\n\t\t\t\t\t\t\tTooltip,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: 'The last payment failed on this card. Please use a different card.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t\th(FeatherIcon, {\n\t\t\t\t\t\t\t\t\tname: 'alert-circle',\n\t\t\t\t\t\t\t\t\tclass: 'h-4 w-4 text-red-600',\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t  )\n\t\t\t\t\t: null,\n\t\t\tcreation: useTimeAgo(card.creation).value,\n\t\t\tactions: {\n\t\t\t\tis_default: card.is_default,\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Set as default',\n\t\t\t\t\t\tonClick: () => setAsDefault(card.name),\n\t\t\t\t\t\tcondition: () => !card.is_default,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Remove',\n\t\t\t\t\t\tonClick: () => removeCard(card.name),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t}\n\t})\n})\n\nconst setAsDefault = (card) => {\n\tcreateResource({\n\t\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\t\tparams: { method: 'billing.set_as_default', data: { name: card } },\n\t\tauto: true,\n\t\tonSuccess: () => {\n\t\t\tcards.reload()\n\t\t},\n\t})\n}\n\nconst removeCard = (card) => {\n\tcreateDialog({\n\t\ttitle: 'Remove Card',\n\t\tmessage: 'Are you sure you want to remove this card?',\n\t\tactions: [\n\t\t\t{\n\t\t\t\tlabel: 'Remove',\n\t\t\t\tvariant: 'solid',\n\t\t\t\ttheme: 'red',\n\t\t\t\tonClick: (close) => {\n\t\t\t\t\tcreateResource({\n\t\t\t\t\t\turl: 'frappe.integrations.frappe_providers.frappecloud_billing.api',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tmethod: 'billing.remove_payment_method',\n\t\t\t\t\t\t\tdata: { name: card },\n\t\t\t\t\t\t},\n\t\t\t\t\t\tauto: true,\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tcards.reload()\n\t\t\t\t\t\t\tclose()\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t})\n}\n</script>\n"],"names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","showAddCardModal","ref","cards","createResource","columns","rows","computed","card","FeatherIcon","Tooltip","useTimeAgo","setAsDefault","removeCard","createDialog","close"],"mappings":"6bACMA,EAAU,CAAC,WAAY,OAAW,KAAC,KAAA,4BAAxC,SAAAC,EAAAC,EAAAC,EAAA,QASKC,EAAA,EAAAC,EAAA,MAAAL,EAAAG,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CARDG,EAAsB,IAAA,CAAC,MAAA,wCAOvB,CALDA,EAAmB,OAAA,CACnB,KAAA,eACA,YAA4X,UAC5X,EAAA,2XACA,MAAA,+BAOK,EAAA,EAAA,IADK,OAAA,KAAA,CAFDA,EAAM,WAAA,CAAC,GAAA,eACkC,CAA5CA,EAAmB,OAAA,CAAC,KAAqB,mhBCwFnD,MAAMC,EAAmBC,EAAI,EAAK,EAE5BC,EAAQC,EAAe,CAC5B,IAAK,+DACL,OAAQ,CAAE,OAAQ,6BAA+B,EACjD,MAAO,QACP,KAAM,EACP,CAAC,EAEKC,EAAU,CACf,CACC,MAAO,eACP,IAAK,cACL,EACD,CACC,MAAO,OACP,IAAK,SACL,MAAO,GACP,EACD,CACC,MAAO,SACP,IAAK,eACL,MAAO,EACP,EACD,CACC,MAAO,WACP,IAAK,oBACL,MAAO,SACP,MAAO,EACP,EACD,CACC,MAAO,GACP,IAAK,QACL,MAAO,QACP,MAAO,EACP,EACD,CACC,MAAO,GACP,IAAK,WACL,MAAO,QACP,MAAO,EACP,EACD,CACC,MAAO,GACP,IAAK,UACL,MAAO,QACP,MAAO,EACP,CACF,EAEMC,EAAOC,EAAS,IAChBJ,EAAM,KACJA,EAAM,KAAK,IAAKK,IACf,CACN,GAAIA,EAAK,KACT,aAAcA,EAAK,aACnB,OAAQ,CACP,MAAOA,EAAK,MACZ,OAAQ,QAAQA,EAAK,MAAM,GAC3B,QAASA,EAAK,UACd,EACD,aAAc,GACbA,EAAK,aAAe,GAAK,IAAIA,EAAK,YAAY,GAAKA,EAAK,YAC5D,IAAOA,EAAK,WAAW,GACpB,kBAAmBA,EAAK,kBACrB,EAAEC,EAAa,CACf,KAAM,eACN,MAAO,wBACb,CAAO,EACD,KACH,MACCD,EAAK,YAAcA,EAAK,sBACrB,EACAE,EACA,CACC,KAAM,oEACN,EACD,IACC,EAAED,EAAa,CACd,KAAM,eACN,MAAO,sBAChB,CAAS,CACF,EACA,KACJ,SAAUE,EAAWH,EAAK,QAAQ,EAAE,MACpC,QAAS,CACR,WAAYA,EAAK,WACjB,QAAS,CACR,CACC,MAAO,iBACP,QAAS,IAAMI,EAAaJ,EAAK,IAAI,EACrC,UAAW,IAAM,CAACA,EAAK,UACvB,EACD,CACC,MAAO,SACP,QAAS,IAAMK,EAAWL,EAAK,IAAI,CACnC,CACD,CACD,CACF,EACA,EAjDuB,CAAC,CAkDzB,EAEKI,EAAgBJ,GAAS,CAC9BJ,EAAe,CACd,IAAK,+DACL,OAAQ,CAAE,OAAQ,yBAA0B,KAAM,CAAE,KAAMI,EAAQ,EAClE,KAAM,GACN,UAAW,IAAM,CAChBL,EAAM,OAAO,CACb,CACH,CAAE,CACF,EAEMU,EAAcL,GAAS,CAC5BM,EAAa,CACZ,MAAO,cACP,QAAS,6CACT,QAAS,CACR,CACC,MAAO,SACP,QAAS,QACT,MAAO,MACP,QAAUC,GAAU,CACnBX,EAAe,CACd,IAAK,+DACL,OAAQ,CACP,OAAQ,gCACR,KAAM,CAAE,KAAMI,CAAM,CACpB,EACD,KAAM,GACN,UAAW,IAAM,CAChBL,EAAM,OAAO,EACbY,EAAM,CACN,CACP,CAAM,CACD,CACD,CACD,CACH,CAAE,CACF"}